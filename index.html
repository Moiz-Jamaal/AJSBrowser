<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://exams.jameasaifiyah.org https://*.jameasaifiyah.org; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://exams.jameasaifiyah.org https://*.jameasaifiyah.org; style-src 'self' 'unsafe-inline' https://exams.jameasaifiyah.org https://*.jameasaifiyah.org; img-src 'self' data: https: blob:; font-src 'self' data: https://exams.jameasaifiyah.org https://*.jameasaifiyah.org; connect-src 'self' https://exams.jameasaifiyah.org https://*.jameasaifiyah.org wss://exams.jameasaifiyah.org wss://*.jameasaifiyah.org; frame-src 'self' https://exams.jameasaifiyah.org https://*.jameasaifiyah.org;">
    <title>AJS Exam Browser - Examination Instructions</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.95;
        }

        .content {
            padding: 40px;
        }

        .welcome-section {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }

        .welcome-section h2 {
            font-size: 1.8em;
            margin-bottom: 10px;
        }

        .proctoring-notice {
            background: #fff3cd;
            border: 3px solid #ffc107;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            position: relative;
        }

        .proctoring-notice::before {
            content: "‚ö†Ô∏è";
            font-size: 3em;
            position: absolute;
            top: -15px;
            right: 20px;
            background: transparent;
            padding: 0 10px;
        }

        .proctoring-notice h3 {
            color: #856404;
            font-size: 1.5em;
            margin-bottom: 15px;
            margin-top: 10px;
        }

        .proctoring-notice p {
            color: #856404;
            font-size: 1.1em;
            margin-bottom: 15px;
        }

        .proctoring-icons {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .proctoring-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            flex: 1;
            min-width: 120px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .proctoring-icon span {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .proctoring-icon p {
            font-size: 0.9em;
            font-weight: bold;
            color: #856404;
            text-align: center;
        }

        .section {
            background: #f8f9fa;
            border-left: 5px solid #667eea;
            padding: 25px;
            margin-bottom: 25px;
            border-radius: 5px;
        }

        .section h3 {
            color: #667eea;
            font-size: 1.4em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section h3::before {
            content: "‚óè";
            color: #667eea;
        }

        .do-dont-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .do-dont-container {
                grid-template-columns: 1fr;
            }
        }

        .do-box {
            background: #d4edda;
            border: 2px solid #28a745;
            border-radius: 10px;
            padding: 20px;
        }

        .do-box h4 {
            color: #155724;
            font-size: 1.3em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .do-box h4::before {
            content: "‚úÖ";
            font-size: 1.5em;
        }

        .dont-box {
            background: #f8d7da;
            border: 2px solid #dc3545;
            border-radius: 10px;
            padding: 20px;
        }

        .dont-box h4 {
            color: #721c24;
            font-size: 1.3em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .dont-box h4::before {
            content: "‚ùå";
            font-size: 1.5em;
        }

        .do-box ul, .dont-box ul {
            list-style: none;
            padding-left: 0;
        }

        .do-box li {
            padding: 8px 0;
            padding-left: 30px;
            position: relative;
            color: #155724;
        }

        .do-box li::before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #28a745;
            font-weight: bold;
            font-size: 1.2em;
        }

        .dont-box li {
            padding: 8px 0;
            padding-left: 30px;
            position: relative;
            color: #721c24;
        }

        .dont-box li::before {
            content: "‚úó";
            position: absolute;
            left: 0;
            color: #dc3545;
            font-weight: bold;
            font-size: 1.2em;
        }

        .features-list {
            list-style: none;
            padding: 0;
        }

        .features-list li {
            padding: 12px;
            margin-bottom: 10px;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #667eea;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .features-list li::before {
            content: "üîí";
            font-size: 1.5em;
        }

        .compliance-section {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }

        .compliance-section h3 {
            font-size: 1.6em;
            margin-bottom: 15px;
        }

        .compliance-checkbox {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            color: #333;
        }

        .compliance-checkbox label {
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            font-size: 1.1em;
            user-select: none;
        }

        .compliance-checkbox input[type="checkbox"] {
            width: 50px;
            height: 50px;
            cursor: pointer;
            transform: scale(2.0);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 18px 50px;
            font-size: 1.3em;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.6);
        }

        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
            box-shadow: none;
        }

        .shortcuts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .shortcut-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .shortcut-item span:first-child {
            font-size: 2em;
        }

        .shortcut-item div {
            flex: 1;
        }

        .shortcut-item strong {
            display: block;
            color: #667eea;
            margin-bottom: 5px;
        }

        .shortcut-item p {
            font-size: 0.9em;
            color: #666;
            margin: 0;
        }

        .footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 20px;
        }

        .footer p {
            margin: 5px 0;
        }

        .scroll-indicator {
            text-align: center;
            padding: 20px;
            color: #667eea;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéì AJS Exam Browser</h1>
            <p>Secure Examination Platform for Jamea Saifiyah</p>
        </div>
        
        <div class="content">
            <div class="welcome-section">
                <h2>Welcome, Student!</h2>
                <p>Please read all instructions carefully before proceeding to your examination</p>
            </div>

            <!-- PROCTORING NOTICE -->
            <div class="proctoring-notice">
                <h3>üìπ IMPORTANT: You Are Being Proctored</h3>
                <p><strong>Your examination session is being monitored through:</strong></p>
                
                <div class="proctoring-icons">
                    <div class="proctoring-icon">
                        <span>üì∏</span>
                        <p>Camera<br>Monitoring</p>
                    </div>
                    <div class="proctoring-icon">
                        <span>üé§</span>
                        <p>Audio<br>Recording</p>
                    </div>
                    <div class="proctoring-icon">
                        <span>üé•</span>
                        <p>Video<br>Recording</p>
                    </div>
                    <div class="proctoring-icon">
                        <span>üñ•Ô∏è</span>
                        <p>Screen<br>Monitoring</p>
                    </div>
                </div>

                <p style="margin-top: 20px; font-weight: bold; font-size: 1.15em;">
                    All activities during the examination are recorded and will be reviewed. 
                    Any suspicious behavior will be flagged and investigated.
                </p>
            </div>

            <!-- WHY THIS BROWSER -->
            <div class="section">
                <h3>Why Use This Browser?</h3>
                <p>The AJS Exam Browser is specifically designed to:</p>
                <ul class="features-list">
                    <li><strong>Ensure Fair Examination:</strong> Prevents unauthorized access to external resources</li>
                    <li><strong>Maintain Academic Integrity:</strong> Blocks cheating tools and methods</li>
                    <li><strong>Protect Exam Content:</strong> Prevents copying, sharing, or downloading questions</li>
                    <li><strong>Monitor Compliance:</strong> Records your session for verification purposes</li>
                    <li><strong>Provide Secure Environment:</strong> Isolates exam from other applications</li>
                </ul>
            </div>

            <!-- BROWSER FEATURES -->
            <div class="section">
                <h3>Browser Security Features</h3>
                <ul class="features-list">
                    <li><strong>Domain Locked:</strong> Only exam portal accessible</li>
                    <li><strong>Always On Top:</strong> Window cannot be hidden or minimized</li>
                    <li><strong>Developer Tools Blocked:</strong> F12 and inspect element disabled</li>
                    <li><strong>Copy-Paste Restricted:</strong> Cannot copy exam content</li>
                    <li><strong>Screenshot Prevention:</strong> Right-click and print screen blocked</li>
                    <li><strong>External Links Blocked:</strong> Cannot navigate to other websites</li>
                    <li><strong>Single Session:</strong> Only one browser window allowed</li>
                </ul>
            </div>

            <!-- DO's AND DON'Ts -->
            <h2 style="text-align: center; color: #667eea; margin: 40px 0 20px;">üìã Examination Rules</h2>
            
            <div class="do-dont-container">
                <div class="do-box">
                    <h4>DO's - Required Actions</h4>
                    <ul>
                        <li>Have your student ID ready for verification</li>
                        <li>Ensure your camera and microphone are working</li>
                        <li>Sit in a well-lit room with clear background</li>
                        <li>Keep your face visible to the camera at all times</li>
                        <li>Place your ID card in view of the camera</li>
                        <li>Close all other applications before starting</li>
                        <li>Use the refresh button (Ctrl+Shift+R) if page freezes</li>
                        <li>Raise hand and wait if you need assistance</li>
                        <li>Read all questions carefully before answering</li>
                        <li>Submit your exam before time expires</li>
                        <li>Stay seated until exam submission is confirmed</li>
                    </ul>
                </div>

                <div class="dont-box">
                    <h4>DON'Ts - Prohibited Actions</h4>
                    <ul>
                        <li>DO NOT use any other browser or application</li>
                        <li>DO NOT leave the camera view during the exam</li>
                        <li>DO NOT cover or disable your camera/microphone</li>
                        <li>DO NOT have any unauthorized materials nearby</li>
                        <li>DO NOT use mobile phones or other devices</li>
                        <li>DO NOT talk to anyone during the examination</li>
                        <li>DO NOT try to access other websites</li>
                        <li>DO NOT attempt to copy exam questions</li>
                        <li>DO NOT take screenshots or photos</li>
                        <li>DO NOT minimize or close the browser window</li>
                        <li>DO NOT have multiple people in the room</li>
                    </ul>
                </div>
            </div>

            <!-- CONSEQUENCES -->
            <div class="section" style="background: #fff3cd; border-left-color: #ffc107;">
                <h3 style="color: #856404;">‚öñÔ∏è Violation Consequences</h3>
                <p style="color: #856404;"><strong>Any violation of examination rules will result in:</strong></p>
                <ul style="color: #856404; list-style: none; padding-left: 20px;">
                    <li>‚Ä¢ Immediate exam termination</li>
                    <li>‚Ä¢ Zero marks for the examination</li>
                    <li>‚Ä¢ Disciplinary action by the institution</li>
                    <li>‚Ä¢ Possible suspension from future examinations</li>
                    <li>‚Ä¢ Referral to academic misconduct committee</li>
                </ul>
            </div>

            <!-- HELPFUL SHORTCUTS -->
            <div class="section">
                <h3>‚å®Ô∏è Helpful Keyboard Shortcuts</h3>
                <div class="shortcuts-grid">
                    <div class="shortcut-item">
                        <span>üîÑ</span>
                        <div>
                            <strong>Ctrl+Shift+R</strong>
                            <p>Hard refresh (if page is stuck)</p>
                        </div>
                    </div>
                    <div class="shortcut-item">
                        <span>üè†</span>
                        <div>
                            <strong>Ctrl+H</strong>
                            <p>Return to exam portal home</p>
                        </div>
                    </div>
                    <div class="shortcut-item">
                        <span>ÔøΩ</span>
                        <div>
                            <strong>Ctrl + / Ctrl -</strong>
                            <p>Zoom in/out for better reading</p>
                        </div>
                    </div>
                    <div class="shortcut-item">
                        <span>‚Ü©Ô∏è</span>
                        <div>
                            <strong>Ctrl+0</strong>
                            <p>Reset zoom to normal size</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- STUDENT IDENTIFICATION -->
            <div class="compliance-section">
                <h3>üÜî Student Identification</h3>
                <p>Please enter your information to begin the examination:</p>
                
                <div class="compliance-checkbox" style="text-align: left;">
                    <div class="form-group">
                        <label style="color: #333; font-weight: bold; margin-bottom: 10px; display: block;">ITS ID *</label>
                        <input type="text" id="itsId" placeholder="Enter your ITS ID" 
                               style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;" required>
                    </div>
                    <div class="form-group" style="margin-top: 15px;">
                        <label style="color: #333; font-weight: bold; margin-bottom: 10px; display: block;">Full Name *</label>
                        <input type="text" id="fullName" placeholder="Enter your full name" 
                               style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;" required>
                    </div>
                    <div class="form-group" style="margin-top: 15px;">
                        <label style="color: #333; font-weight: bold; margin-bottom: 10px; display: block;">Email (Optional)</label>
                        <input type="email" id="email" placeholder="Enter your email" 
                               style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;">
                    </div>
                </div>
            </div>

            <!-- REMOTE MONITORING CONSENT -->
            <div class="compliance-section" style="background: linear-gradient(135deg, #ff9966 0%, #ff5e62 100%);">
                <h3>üìπ Remote Monitoring & Privacy Consent</h3>
                <p style="text-align: left; margin: 20px 0;">
                    <strong>BY CHECKING THE BOX BELOW, YOU EXPLICITLY CONSENT TO:</strong>
                </p>
                <ul style="text-align: left; margin: 20px 40px; font-size: 1.05em;">
                    <li style="margin-bottom: 10px;">‚úì Real-time screen monitoring and recording</li>
                    <li style="margin-bottom: 10px;">‚úì Periodic automatic screenshot capture</li>
                    <li style="margin-bottom: 10px;">‚úì Camera and microphone monitoring (audio/video recording)</li>
                    <li style="margin-bottom: 10px;">‚úì Remote access to your computer by authorized administrators</li>
                    <li style="margin-bottom: 10px;">‚úì Tracking of all keyboard and mouse activities</li>
                    <li style="margin-bottom: 10px;">‚úì Recording of all applications and windows accessed</li>
                    <li style="margin-bottom: 10px;">‚úì Storage and review of all monitoring data for academic integrity purposes</li>
                </ul>
                <p style="text-align: left; margin: 20px 0; font-size: 0.95em;">
                    <strong>Data Usage:</strong> All recorded data will be used solely for examination integrity verification 
                    and may be reviewed by authorized personnel. Data will be stored securely and handled in accordance 
                    with applicable privacy laws. Refusing consent will result in inability to take the examination.
                </p>
                
                <div class="compliance-checkbox" style="background: rgba(255,255,255,0.95);">
                    <label>
                        <input type="checkbox" id="remoteConsent">
                        <span style="font-weight: bold;">
                            I understand and explicitly consent to remote monitoring, screen capture, 
                            camera/audio recording, and remote access to my computer during this examination.
                        </span>
                    </label>
                </div>
            </div>

            <!-- COMPLIANCE AGREEMENT -->
            <div class="compliance-section">
                <h3>üìù Compliance Agreement</h3>
                <p>By proceeding, you acknowledge and agree to the following:</p>
                
                <div class="compliance-checkbox">
                    <label>
                        <input type="checkbox" id="agreeTerms">
                        <span>
                            I have read and understood all examination rules and regulations. 
                            I agree to comply with all instructions and acknowledge that I am being proctored 
                            through camera, audio, and video recording. I understand that any violation 
                            will result in disciplinary action.
                        </span>
                    </label>
                </div>

                <button id="goToExams" class="btn-primary" disabled>
                    ‚úì I COMPLY - ENTER EXAMINATION
                </button>
            </div>

            <div class="scroll-indicator">
                <p>üìú Make sure you have read all instructions above before proceeding</p>
            </div>
        </div>

        <div class="footer" id="adminFooter" style="cursor: default;">
            <p><strong>Technical Support:</strong> Contact your system administrator</p>
            <p>Jamea Saifiyah Examination Portal ‚Ä¢ AJS Exam Browser v1.0.0</p>
        </div>
    </div>

    <script>
        // Enable button only when all requirements are met
        const itsIdInput = document.getElementById('itsId');
        const fullNameInput = document.getElementById('fullName');
        const emailInput = document.getElementById('email');
        const remoteConsentCheckbox = document.getElementById('remoteConsent');
        const agreeCheckbox = document.getElementById('agreeTerms');
        const goToExamsBtn = document.getElementById('goToExams');

        function checkAllRequirements() {
            const itsId = itsIdInput.value.trim();
            const fullName = fullNameInput.value.trim();
            const remoteConsent = remoteConsentCheckbox.checked;
            const termsAgreed = agreeCheckbox.checked;
            
            goToExamsBtn.disabled = !(itsId && fullName && remoteConsent && termsAgreed);
        }

        itsIdInput.addEventListener('input', checkAllRequirements);
        fullNameInput.addEventListener('input', checkAllRequirements);
        remoteConsentCheckbox.addEventListener('change', checkAllRequirements);
        agreeCheckbox.addEventListener('change', checkAllRequirements);

        goToExamsBtn.addEventListener('click', async () => {
            const itsId = itsIdInput.value.trim();
            const fullName = fullNameInput.value.trim();
            const email = emailInput.value.trim();
            
            if (!itsId || !fullName) {
                alert('Please enter your ITS ID and Full Name');
                return;
            }
            
            if (!remoteConsentCheckbox.checked) {
                alert('You must consent to remote monitoring to proceed');
                return;
            }
            
            if (!agreeCheckbox.checked) {
                alert('You must agree to the compliance terms to proceed');
                return;
            }
            
            // Store student info in localStorage
            localStorage.setItem('studentItsId', itsId);
            localStorage.setItem('studentName', fullName);
            localStorage.setItem('studentEmail', email);
            localStorage.setItem('consentGiven', 'true');
            localStorage.setItem('consentTimestamp', new Date().toISOString());
            
            // Send to backend server (if running)
            try {
                const response = await fetch('http://localhost:3000/api/student/verify', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        itsId,
                        fullName,
                        email,
                        consentGiven: true
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('‚úÖ Student verification successful:', result);
                    
                    // Also create initial session
                    const sessionResponse = await fetch('http://localhost:3000/api/session/create', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            itsId,
                            studentName: fullName,
                            machineInfo: {
                                platform: navigator.platform,
                                userAgent: navigator.userAgent,
                                screenResolution: `${window.screen.width}x${window.screen.height}`,
                                language: navigator.language
                            }
                        })
                    });
                    
                    if (sessionResponse.ok) {
                        const session = await sessionResponse.json();
                        console.log('‚úÖ Session created:', session);
                        localStorage.setItem('sessionId', session.sessionId);
                    }
                } else {
                    console.warn('‚ö†Ô∏è Server returned error:', response.status);
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è Could not connect to monitoring server:', error);
                console.log('üì¥ Running in offline mode - data will not be monitored');
                // Continue anyway - offline mode
            }
            
            // Navigate to exam portal
            window.location.href = 'https://exams.jameasaifiyah.org';
        });

        // Prevent right-click
        document.addEventListener('contextmenu', (e) => {
            e.preventDefault();
            return false;
        });

        // Prevent DevTools shortcuts
        document.addEventListener('keydown', (e) => {
            if (
                e.key === 'F12' ||
                (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J' || e.key === 'C')) ||
                (e.ctrlKey && e.key === 'U')
            ) {
                e.preventDefault();
                return false;
            }
        });

        // Smooth scroll to top on load
        window.addEventListener('load', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Hidden admin unlock - 5 clicks on footer within 3 seconds
        let unlockClickCount = 0;
        let unlockClickTimer = null;
        const adminFooter = document.getElementById('adminFooter');

        if (adminFooter) {
            adminFooter.addEventListener('click', function(e) {
                unlockClickCount++;
                
                // Clear previous timer
                if (unlockClickTimer) {
                    clearTimeout(unlockClickTimer);
                }
                
                // Visual feedback (subtle) - optional
                adminFooter.style.opacity = '0.7';
                setTimeout(() => {
                    adminFooter.style.opacity = '1';
                }, 100);
                
                // If 5 clicks within 3 seconds, trigger unlock
                if (unlockClickCount >= 5) {
                    unlockClickCount = 0;
                    
                    // Check if electronAPI exists (we're in Electron)
                    if (window.electronAPI && window.electronAPI.unlockAdmin) {
                        window.electronAPI.unlockAdmin();
                        console.log('üîì Admin unlock triggered');
                    }
                    return;
                }
                
                // Reset counter after 3 seconds of inactivity
                unlockClickTimer = setTimeout(() => {
                    unlockClickCount = 0;
                }, 3000);
            });
        }
    </script>
</body>
</html>
